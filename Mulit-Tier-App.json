{
  "displayName": "Multi-Tier Application",
  "gridLayout": {
    "columns": "3",
    "widgets": [
      {
            "text": {
              "content": "
              # Application Tier

              Look for excessive HTTP error codes or application Load times

              * If excessive error rates move to [Istio Dashboard](https://) to identify root Service
              * If slow page load times
              * Check [Istio Dashboard](https://) to look for slow resposne rates
              * Verify cluster and database system capacity below is not over thresholds
               
              ### Application contact is [XX@company.com](mailto:XX@company.com)",
              "format": "MARKDOWN"
            }
      },
      {
        "title": "HTTP Response Codes",
        "xyChart": {
          "dataSets": [
            {
              "timeSeriesQuery": {
                "timeSeriesFilter": {
                  "filter": "metric.type=\"istio.io/service/client/request_count\" resource.type=\"k8s_pod\"",
                  "aggregation": {
                    "perSeriesAligner": "ALIGN_SUM",
                    "crossSeriesReducer": "REDUCE_SUM",
                    "groupByFields": [
                      "metric.label.\"response_code\""
                    ]
                  }
                },
                "unitOverride": "1"
              },
              "plotType": "STACKED_AREA",
              "minAlignmentPeriod": "60s"
            }
          ],
          "timeshiftDuration": "0s",
          "yAxis": {
            "label": "y1Axis",
            "scale": "LINEAR"
          },
          "chartOptions": {
            "mode": "COLOR"
          }
        }
      },
      {
        "title": "HTTP Requests",
        "xyChart": {
          "dataSets": [
            {
              "timeSeriesQuery": {
                "timeSeriesFilter": {
                  "filter": "metric.type=\"istio.io/service/client/request_count\" resource.type=\"k8s_pod\" resource.label.\"namespace_name\"=\"wordpress\"",
                  "aggregation": {
                    "perSeriesAligner": "ALIGN_SUM",
                    "crossSeriesReducer": "REDUCE_COUNT"
                  }
                },
                "unitOverride": "1"
              },
              "plotType": "STACKED_AREA",
              "minAlignmentPeriod": "60s"
            }
          ],
          "timeshiftDuration": "0s",
          "yAxis": {
            "label": "y1Axis",
            "scale": "LINEAR"
          },
          "chartOptions": {
            "mode": "COLOR"
          }
        }
      },
       {
            "text": {
              "content": "
              # Infrastructure Tier

              Look for excessive CPU, Memory, or Disk Usage

             Nodes are set to autoscale. Verify no errors in [audit log](https://pantheon.corp.google.com/home/activity?project=bkauf-monitoring) for machine start issues.
             Pods in the cluster have memory and CPU thresholds. Verify none are exceeded [here](https://pantheon.corp.google.com/monitoring/dashboards/resourceList/kubernetes?project=bkauf-monitoring&timeDomain=1h_)
             ### Infrastructure contact is [XX@company.com](mailto:XX@company.com)",
              "format": "MARKDOWN"
            }
      },
      {
        "title": "Cluster Node CPU %",
        "xyChart": {
          "dataSets": [
            {
              "timeSeriesQuery": {
                "timeSeriesFilter": {
                  "filter": "metric.type=\"kubernetes.io/node/cpu/allocatable_utilization\" resource.type=\"k8s_node\"",
                  "aggregation": {
                    "perSeriesAligner": "ALIGN_MEAN",
                    "crossSeriesReducer": "REDUCE_SUM"
                  }
                },
                "unitOverride": "percent"
              },
              "plotType": "STACKED_BAR",
              "minAlignmentPeriod": "60s"
            }
          ],
          "timeshiftDuration": "0s",
          "yAxis": {
            "label": "y1Axis",
            "scale": "LINEAR"
          },
          "chartOptions": {
            "mode": "COLOR"
          }
        }
      },
      {
        "title": "Cluster Node Memory %",
        "xyChart": {
          "dataSets": [
            {
              "timeSeriesQuery": {
                "timeSeriesFilter": {
                  "filter": "metric.type=\"kubernetes.io/node/memory/allocatable_utilization\" resource.type=\"k8s_node\"",
                  "aggregation": {
                    "perSeriesAligner": "ALIGN_MEAN",
                    "crossSeriesReducer": "REDUCE_SUM",
                    "groupByFields": [
                      "resource.label.\"cluster_name\""
                    ]
                  }
                },
                "unitOverride": "percent"
              },
              "plotType": "STACKED_AREA",
              "minAlignmentPeriod": "60s"
            }
          ],
          "timeshiftDuration": "0s",
          "yAxis": {
            "label": "y1Axis",
            "scale": "LINEAR"
          },
          "chartOptions": {
            "mode": "COLOR"
          }
        }
      }, 
      {
            "text": {
              "content": "
              # Database Tier

             Look for excessive queries or response times. 
             Database is set to scale storage automatically. Other Database metrics can be found [here](https://pantheon.corp.google.com/monitoring/dashboards/resourceList/cloudsql_database?project=bkauf-monitoring&timeDomain=1h)
            
            
             ### Database contact is [XX@company.com](mailto:XX@company.com)",
             "format": "MARKDOWN"
            }
      },

      {
        "title": "Database Query Count",
        "xyChart": {
          "dataSets": [
            {
              "timeSeriesQuery": {
                "timeSeriesFilter": {
                  "filter": "metric.type=\"cloudsql.googleapis.com/database/mysql/queries\" resource.type=\"cloudsql_database\"",
                  "aggregation": {
                    "perSeriesAligner": "ALIGN_RATE"
                  }
                },
                "unitOverride": "1"
              },
              "plotType": "LINE",
              "minAlignmentPeriod": "60s"
            }
          ],
          "timeshiftDuration": "0s",
          "yAxis": {
            "label": "y1Axis",
            "scale": "LINEAR"
          },
          "chartOptions": {
            "mode": "COLOR"
          }
        }
      },
      {
        "title": "Database CPU",
        "xyChart": {
          "dataSets": [
            {
              "timeSeriesQuery": {
                "timeSeriesFilter": {
                  "filter": "metric.type=\"cloudsql.googleapis.com/database/cpu/utilization\" resource.type=\"cloudsql_database\"",
                  "aggregation": {
                    "perSeriesAligner": "ALIGN_MEAN"
                  }
                },
                "unitOverride": "ratio"
              },
              "plotType": "LINE",
              "minAlignmentPeriod": "60s"
            }
          ],
          "timeshiftDuration": "0s",
          "yAxis": {
            "label": "y1Axis",
            "scale": "LINEAR"
          },
          "chartOptions": {
            "mode": "COLOR"
          }
        }
      }
    ]
  }
}
